<h1 align="center">The Costs of Counterparty Risk in Long-term Contracts:<br>Numerical Exercise</h1>

Weâ€™re delighted to have you visit our repository! ğŸ‘‹

## ğŸ“š About This Repository

The aim of this repository is to provide numerical solutions for the paper  **The Costs of Counterparty Risk in Long-term Contracts**, jointly written by **Prof. Natalia Fabra (CEMFI)** and **Prof. Gerard Llobet (CEMFI)**.

Here, you will find all the necessary code, data, and documentation to reproduce and explore the numerical methods and results presented in the paper. We hope this resource is helpful. ğŸ’»

---

### ğŸ“‚ Folders

- **`code/`**  
  Contains all scripts and source code used for the numerical methods and analyses in the paper.

- **`data/`**  
  Contains the raw input data required to run the code and reproduce the results.

- **`out/`**  
  Stores all outputs generated by the code, including figures and tables.

  The structure is organized by **presence or absence of counterparty risk (CPR)**:

  #### â• `figures/counterparty_risk/`

  - `wind_solar_proj_2022/`  
    Subdirectory containing all outputs related to the wind/solar project simulations.

    - `paper_version/` *(when `selected_color_theme == "Blue"`)*  
    - `presentation_version/` *(when `selected_color_theme == "Green"`)*  

      Within either version, the outputs are further grouped by policy scenario:

      - `Baseline/` â€“ Results with no intervention.  
      - `Public_Subsidies/` â€“ Results under a public subsidy scheme.  
      - `Public_Guarantees/` â€“ Results under a public guarantee mechanism.  
      - `Regulator_Backed_Contracts/` â€“ Results when contracts are backed by a regulator.

      Each folder contains figures (e.g., supply curves, welfare plots) corresponding to the specific scenario and color theme.
      
  #### â• `figures/no_counterparty_risk/`

  - `wind_solar_proj_2022/`  
    Subdirectory containing results **without counterparty risk**, again divided by theme:

    - `paper_version/` *(Blue theme)*  
    - `presentation_version/` *(Green theme)*  

      Each version includes two main figures:

      - `01_supply_no_cpr[_paper|_presentation].pdf`  
        Plots the aggregate supply curve as a step function by cumulative production and capacity.

      - `02_supply_demand_no_cpr[_paper|_presentation].pdf`  
        Includes both the supply step function and the vertical demand line at the chosen contract quantity (`theta = 3500`).
        
  #### ğŸ—ºï¸ Global Theme-Based Figures (not scenario-specific)

  In addition to scenario-based outputs, there are two global figures saved directly in the top-level `figures/` folder, updated based on the selected theme:

    - `solar_wind_avg_cost_cumulative_capacity[_paper|_presentation].pdf`:  
  Plots average cost (â‚¬/MWh) vs. cumulative capacity across all projects.

    - `spain_map_wind_solar_proj_2022[_paper|_presentation].pdf`:  
  Displays all wind and solar projects on a map of Spain, sized by capacity and colored by technology.

These files are not inside the CPR or no-CPR subfolders â€” they are general visualizations shared across scenarios.

- **`documentation/`**  
  Includes additional documentation. In particular, it contains two different files:
  
    1. **`README_overview/README_Numerical_Solutions.pdf`**  
    Provides a structured overview of the numerical code. It walks through each section, explaining the overall logic, methodology, and how the different parts of the code contribute to the main results.

    2. **`README_technical/`**  
    Offers an in-depth, technical breakdown of the code. It details individual functions, variable structures, and implementation logic by code sections, making it especially useful for people who want to understand, and possibly, modify the code.

---

### ğŸš€ Getting Started

1. ğŸ§¬ **Clone** the repository.
2. ğŸ“– **Read** the documentation in `documentation/` for detailed instructions on running the code and understanding the functions.
3. ğŸ§  **Run** the script in `code/`.

---

For any questions, please refer to the [paper](https://gllobet.github.io/papers/PPAs.pdf) or contact the authors.
